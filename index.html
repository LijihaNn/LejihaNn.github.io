<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>포켓몬 탐험 & 도감 게임</title>
<style>
    body { font-family: sans-serif; }
    #game {
        width: 320px;
        height: 320px;
        image-rendering: pixelated;
    }
    #log { white-space: pre-line; margin-top: 10px; height: 80px; overflow-y: auto; }
    #dex { margin-top: 20px; }
    .tile { width: 32px; height: 32px; display: inline-block; }
</style>
</head>
<body>

<h1>포켓몬 탐험 & 도감</h1>

<canvas id="game" width="320" height="320"></canvas>

<p id="log"></p>
<button id="catchBtn" style="display:none;">포획하기</button>

<h2>도감</h2>
<div id="dex"></div>

<script>
// ----------------------------
// 1. 맵 데이터
// ----------------------------
const map = [
  "##########",
  "#........#",
  "#..~~~~..#",
  "#..~~~~..#",
  "#..####..#",
  "#..####..#",
  "#........#",
  "##########",
  "#........#",
  "##########"
];
// . = 평지 / ~ = 풀숲 / # = 벽

// ----------------------------
// 2. 플레이어
// ----------------------------
let player = { x: 2, y: 2 };

// ----------------------------
// 3. 포켓몬 데이터
// ----------------------------
const areas = {
  grass: [
    { name: "피카츄", rate: 40 },
    { name: "모다피", rate: 40 },
    { name: "뮤", rate: 5 },       // 희귀
    { name: "치코리타", rate: 15 }
  ]
};

// ----------------------------
// 4. 도감 저장
// ----------------------------
let dex = JSON.parse(localStorage.getItem("dex")) || [];

function updateDex() {
  const box = document.getElementById("dex");
  box.innerHTML = dex.length
    ? dex.join(", ")
    : "아직 잡은 포켓몬이 없습니다.";
}
updateDex();

// ----------------------------
// 5. 렌더링
// ----------------------------
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function draw() {
  ctx.clearRect(0, 0, 320, 320);
  for (let y = 0; y < map.length; y++) {
    for (let x = 0; x < map[y].length; x++) {
      const t = map[y][x];
      if (t === "#") ctx.fillStyle = "#444";
      else if (t === "~") ctx.fillStyle = "#7bcf5b";
      else ctx.fillStyle = "#a3d9ff";
      ctx.fillRect(x * 32, y * 32, 32, 32);
    }
  }

  // player
  ctx.fillStyle = "red";
  ctx.fillRect(player.x * 32 + 8, player.y * 32 + 8, 16, 16);
}

// ----------------------------
// 6. 이동
// ----------------------------
function canMove(x, y) {
  return map[y] && map[y][x] && map[y][x] !== "#";
}

document.addEventListener("keydown", (e) => {
  let nx = player.x, ny = player.y;

  if (e.key === "ArrowUp") ny--;
  if (e.key === "ArrowDown") ny++;
  if (e.key === "ArrowLeft") nx--;
  if (e.key === "ArrowRight") nx++;

  if (canMove(nx, ny)) {
    player.x = nx;
    player.y = ny;
    draw();
    checkEncounter();
  }
});

// ----------------------------
// 7. 포켓몬 조우
// ----------------------------
let currentWild = null;

function checkEncounter() {
  const tile = map[player.y][player.x];

  // 풀숲 위에서 15% 확률로 등장
  if (tile === "~" && Math.random() < 0.15) {
    const wild = pickRandomPokemon(areas.grass);
    currentWild = wild;
    log(`야생 ${wild.name} 이(가) 나타났다!`);
    document.getElementById("catchBtn").style.display = "inline-block";
  }
}

function pickRandomPokemon(list) {
  let sum = list.reduce((a, b) => a + b.rate, 0);
  let r = Math.random() * sum;
  for (let p of list) {
    if ((r -= p.rate) < 0) return p;
  }
}

// ----------------------------
// 8. 포획
// ----------------------------
document.getElementById("catchBtn").onclick = () => {
  if (!currentWild) return;

  const chance = 50; // 단순화 (50% 확률)
  const roll = Math.random() * 100;

  if (roll <= chance) {
    log(`성공! ${currentWild.name} 포획!`);
    if (!dex.includes(currentWild.name)) dex.push(currentWild.name);
    localStorage.setItem("dex", JSON.stringify(dex));
    updateDex();
  } else {
    log("포획 실패! 포켓몬이 도망쳤다!");
  }

  currentWild = null;
  document.getElementById("catchBtn").style.display = "none";
};

// ----------------------------
function log(t) {
  document.getElementById("log").innerText = t;
}

draw();
</script>
</body>
</html>
